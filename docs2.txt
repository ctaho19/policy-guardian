Issue with the Calculated Field (Reiterated)

The countOver function:

countOver({CTRL_ID}, [{CTRL_ID}, {AGGREGATED_STATUS}, DATE])

	•	This results in a count of 1 for each CTRL_ID because CTRL_ID is part of the partition. For a pie chart, you likely want:
distinctCountOver({CTRL_ID}, [{AGGREGATED_STATUS}])

This would give you the distinct count of CTRL_IDs for each AGGREGATED_STATUS, which is more appropriate for a percentage split by status.

However, since you’re currently using test_cnt_over_03-27 as defined, we’ll proceed with that and adjust later if needed.

Adjusting the Highcharts JSON

For a pie chart, we want to:

	1.	Use AGGREGATED_STATUS as the primary dimension for the pie chart slices.
	2.	Use the value field (test_cnt_over_03-27) as the measure for each slice.
	3.	Ignore the additional group-by fields (DATE and CTRL_ID) for the pie chart itself, as a pie chart typically visualizes a single dimension. QuickSight will aggregate over these fields automatically.

Here’s the updated Highcharts JSON configuration:

{
    "chart": {
        "type": "pie"
    },
    "title": {
        "text": "DISTRIBUTION BREAKDOWN: PERCENTAGE SPLIT BY COMPLIANCE STATUS"
    },
    "tooltip": {
        "valueSuffix": "%"
    },
    "plotOptions": {
        "pie": {
            "allowPointSelect": true,
            "cursor": "pointer",
            "dataLabels": [
                {
                    "enabled": true,
                    "distance": 20
                },
                {
                    "enabled": true,
                    "distance": -40,
                    "format": "{point.percentage:.1f}%",
                    "style": {
                        "fontSize": "1.2em",
                        "textOutline": "none",
                        "opacity": 0.7
                    },
                    "filter": {
                        "operator": ">",
                        "property": "percentage",
                        "value": 10
                    }
                }
            ]
        }
    },
    "series": [
        {
            "name": "Percentage",
            "colorByPoint": true,
            "data": {
                "type": "array",
                "values": [
                    ["getColumn", 0],
                    ["getColumn", 3]
                ]
            }
        }
    ]
}

Explanation of the Configuration

	1.	Group By and Value Mapping:
	•	Group By Fields (from the screenshot):
	1.	AGGREGATED_STATUS (index 0)
	2.	DATE (index 1)
	3.	CTRL_ID (index 2)
	•	Value Field:
	•	test_cnt_over_03-27 (index 3, since it’s the first value field after the three group-by fields).
	•	In the JSON, ["getColumn", 0] maps to AGGREGATED_STATUS (the category for the pie chart slices), and ["getColumn", 3] maps to test_cnt_over_03-27 (the value for each slice).
	2.	Ignoring Extra Group-By Fields:
	•	The pie chart only needs AGGREGATED_STATUS as the dimension. DATE and CTRL_ID are additional group-by fields that QuickSight will aggregate over when calculating the values for test_cnt_over_03-27. For a single pie chart, these extra fields don’t need to be explicitly referenced in the JSON.
	3.	Calculated Field Consideration:
	•	As noted, the current countOver calculation might not give the desired result for a pie chart. If the pie chart doesn’t show the expected distribution, you should update the calculated field to:
distinctCountOver({CTRL_ID}, [{AGGREGATED_STATUS}])

Name it something like distinct_ctrl_id_by_status, and replace test_cnt_over_03-27 in the “Value” field with this new calculated field. The getColumn index (3) will remain the same unless you change the order of fields.

Steps to Implement

	1.	Update the Calculated Field (Recommended):
	•	In QuickSight, go to the dataset (CYBER_CONTROLS) and create a new calculated field:
distinctCountOver({CTRL_ID}, [{AGGREGATED_STATUS}])

Name it distinct_ctrl_id_by_status.
	•	In the Highcharts visual, replace test_cnt_over_03-27 in the “Value” field with distinct_ctrl_id_by_status. This will ensure the pie chart shows the distinct count of CTRL_IDs per AGGREGATED_STATUS.
	2.	Set Up the Highcharts Visual:
	•	Keep the “Group By” fields as shown: AGGREGATED_STATUS, DATE, CTRL_ID.
	•	Set the “Value” field to test_cnt_over_03-27 (or distinct_ctrl_id_by_status if you updated it).
	•	Open the “Chart code” section in the Highcharts visual properties.
	•	Paste the JSON above into the editor.
	3.	Verify the Output:
	•	QuickSight should render a pie chart with slices for each AGGREGATED_STATUS (e.g., “red”, “yellow”, “green”).
	•	The size of each slice will be based on the value of test_cnt_over_03-27 (or the new calculated field), and the percentages will be displayed as configured.

Additional Notes

	•	Extra Group-By Fields:
	•	DATE and CTRL_ID are aggregated over by QuickSight when calculating the value field. If you want to filter by DATE or CTRL_ID, you can add filter controls in QuickSight. For a single pie chart, these fields don’t need to be part of the chart’s data structure.
	•	Colors:
	•	The colorByPoint: true setting ensures each AGGREGATED_STATUS gets a different color. QuickSight uses its default color palette, and you can’t specify exact colors (e.g., red for “red”) in the JSON due to QuickSight’s limitations.
	•	Troubleshooting:
	•	If the chart doesn’t render, double-check the JSON for syntax errors (e.g., trailing commas).
	•	If the distribution looks incorrect, verify the calculated field by switching to a table visual to see the raw data. The values for test_cnt_over_03-27 might not be aggregating as expected due to the CTRL_ID in the partition.

If the Chart Doesn’t Show the Expected Distribution

	•	Check the Calculated Field:
	•	Switch to a table visual temporarily and check the values of test_cnt_over_03-27 for each AGGREGATED_STATUS. If the counts don’t match your expectation (e.g., they’re too granular due to CTRL_ID in the partition), update the calculated field as suggested.
	•	Adjust getColumn Indices:
	•	If you change the order of fields in the “Group By” or “Value” sections, update the getColumn indices accordingly.

Let me know if you need further adjustments or if the chart isn’t rendering as expected!