WITH CTE AS (
    SELECT 
        DATE,
        MONITORING_METRIC_NUMBER,
        ROW_NUMBER() OVER (PARTITION BY DATE, MONITORING_METRIC_NUMBER ORDER BY DATE DESC) AS RN
    FROM CYBR_DB_COLLAB.LAB_ESRA_TCRD.CYBER_CONTROLS_MONITORING
    WHERE DATE = '2025-02-26'
)
DELETE FROM CYBR_DB_COLLAB.LAB_ESRA_TCRD.CYBER_CONTROLS_MONITORING 
WHERE (DATE, MONITORING_METRIC_NUMBER) IN (
    SELECT DATE, MONITORING_METRIC_NUMBER 
    FROM CTE
    WHERE RN > 1
);
