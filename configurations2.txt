It is derived by first querying the EIAM_DB.PHDP_CYBR_IAM.IDENTITY_REPORTS_IAM_RESOURCE_V3 table to identify all IAM roles, filtering for machine roles (ROLE_TYPE = 'MACHINE') in approved accounts (a predefined list of AWS accounts), and deduplicating to keep the most recent record per role, resulting in a denominator of total machine roles in scope. The pipeline then queries the EIAM_DB.PHDP_CYBR_IAM.IDENTITY_REPORTS_CONTROLS_VIOLATIONS_STREAM_V2 table to identify roles evaluated against CM-2.AWS.12.v02, matching these against the filtered machine roles to determine the numerator—the number of roles actually assessed. The metric is computed as the percentage of evaluated roles out of the total ((numerator / denominator) * 100), rounded to two decimal places, and the compliance status is determined using thresholds from CYBR_DB_COLLAB.LAB_ESRA_TCRD.CYBER_CONTROLS_MONITORING_THRESHOLD

The Tier 2 metric (MNTR-XXXXX-T2) measures the compliance rate of IAM machine roles in approved AWS accounts that have been evaluated against the control CM-2.AWS.12.v02, providing the control owner with a clear view of how well these roles adhere to security requirements. It is derived by first identifying machine roles in approved accounts from the EIAM_DB.PHDP_CYBR_IAM.IDENTITY_REPORTS_IAM_RESOURCE_V3 table, filtering for ROLE_TYPE = 'MACHINE' and matching against a predefined list of approved accounts, then matching these roles with compliance data from EIAM_DB.PHDP_CYBR_IAM.IDENTITY_REPORTS_CONTROLS_VIOLATIONS_STREAM_V2 for CM-2.AWS.12.v02. The denominator is the total number of evaluated machine roles, determined by the count of roles with matching ARNs, while the numerator is the count of those roles with a COMPLIANCE_STATUS other than NonCompliant, indicating they meet the control’s requirements. The metric is computed as the percentage of compliant roles ((numerator / denominator) * 100), rounded to two decimal places, and the compliance status is determined using thresholds from CYBR_DB_COLLAB.LAB_ESRA_TCRD.CYBER_CONTROLS_MONITORING_THRESHOLD, defaulting to GREEN if thresholds are unavailable. This metric ensures that the control owner is alerted to non-compliant machine roles that may pose security risks, enabling timely remediation to maintain compliance.

The Tier 3 metric (MNTR-XXXXX-T3) measures the SLA compliance rate of non-compliant IAM machine roles identified in Tier 2, ensuring that violations of the control CM-2.AWS.12.v02 are remediated within designated timeframes based on their risk level, thus minimizing the window of exposure to security risks. It is derived by first calculating the total number of non-compliant roles from Tier 2 metrics (tier2_denominator - tier2_numerator), using the evaluated_roles_with_compliance dataset to extract the RESOURCE_IDs of roles with COMPLIANCE_STATUS = 'NonCompliant', which serves as the denominator (e.g., 53 roles). The pipeline then queries the CLCN_DB.PHDP_CLOUD.OZONE_NON_COMPLIANT_RESOURCES_TCRD_VIEW_V01 table for these specific resources, retrieving their CONTROL_RISK and OPEN_DATE_UTC_TIMESTAMP, and excluding remediated resources using OZONE_CLOSED_NON_COMPLIANT_RESOURCES_V04. For each resource, the pipeline calculates the days since the violation was opened and compares this against SLA thresholds (Critical: 0 days, High: 30 days, Medium: 60 days, Low: 90 days), counting resources as past SLA if the threshold is exceeded, resulting in a past_sla_count. The numerator is the number of non-compliant roles within SLA (total_non_compliant - past_sla_count), and the metric is computed as the percentage within SLA ((numerator / denominator) * 100), rounded to two decimal places. The compliance status is determined using thresholds from CYBR_DB_COLLAB.LAB_ESRA_TCRD.CYBER_CONTROLS_MONITORING_THRESHOLD, defaulting to GREEN if thresholds are unavailable, ensuring the control owner is alerted only when defined SLAs are breached, prompting timely remediation of non-compliant roles.

