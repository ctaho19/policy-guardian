# Fallback if the alternative above still causes errors: Use a standard loop

safe_metric_ids = []
for mid in metric_ids:
    if mid: # Ensure mid is not None or empty before processing
        # 1. Clean the ID: remove internal single quotes
        cleaned_mid = str(mid).replace("'", "") 
        # 2. Wrap the cleaned ID in literal single quotes for SQL
        quoted_id = f"'{cleaned_mid}'" 
        safe_metric_ids.append(quoted_id)

# Now safe_metric_ids list is built correctly
